# Машинное обучение — Домашнее задание №1

Автор: _ВШЭ, Искусственный Интеллект_

-------

## Запуск Streamlit-приложения

```bash
pip install -r requirements.txt
```

```bash
streamlit run app.py
```

## Структура проекта

Данная работа содержит следующие компоненты:
1. `HW1_Regression_with_inference_base.ipynb` — ноутбук с полным исследованием
2. `car_price_model.pkl` — файл с обученной моделью и артефактами
3. `app.py` — Streamlit-приложение для предсказания цен
4. `README.md` — отчёт о проделанной работе
5. `requirements.txt` — зависимости проекта

## Что было сделано

### Этап 1 — EDA и предобработка данных
- Изучены типы данных, выявлены пропуски и дубликаты
- Обработаны строковые числовые признаки: `mileage`, `engine`, `max_power`
- Удалён признак `torque` (сложная структура данных)
- Заполнены пропуски медианными значениями из train
- Удалены частичные дубликаты (1159 строк)
- Удалён признак `name` (слишком много уникальных категорий)
- Проведён корреляционный анализ и построены визуализации

### Этап 2 — Модели на числовых признаках
Построены и оценены следующие модели:
- Linear Regression (baseline)
- Linear Regression со стандартизацией
- Lasso Regression
- Lasso с GridSearchCV (подбор alpha)
- ElasticNet с GridSearchCV (подбор alpha и l1_ratio)

### Этап 3 — Работа с категориальными признаками
- Применено OneHot-кодирование с `drop='first'` для избежания мультиколлинеарности
- Закодированы признаки: `fuel`, `seller_type`, `transmission`, `owner`, `seats`
- Обучена Ridge-регрессия с GridSearchCV на полном наборе признаков

### Этап 4 — Бизнес-метрика
- Реализована кастомная метрика: доля прогнозов с отклонением ≤10%
- Проведено сравнение всех моделей по бизнес-метрике

### Этап 5 — Streamlit-приложение
Создано интерактивное приложение с тремя вкладками:
- **EDA** — визуализация данных и корреляционный анализ
- **Предсказание** — загрузка CSV или ручной ввод признаков
- **Веса модели** — визуализация важности признаков

## Результаты экспериментов

Сравнение моделей по метрикам качества:

| Модель                          | R² (train) | R² (test) | MSE (test)    | Business metric (±10%) |
|---------------------------------|------------|-----------|---------------|------------------------|
| Linear Regression               | 0.5923     | 0.5941    | 2.33e11       | 0.227                  |
| Linear Regression (Standardized)| 0.5923     | 0.5941    | 2.33e11       | 0.227                  |
| Lasso                           | 0.5923     | 0.5941    | 2.33e11       | 0.227                  |
| Lasso (GridSearchCV)            | —          | —         | —             | —                      |
| ElasticNet (GridSearchCV)       | 0.5845     | 0.5615    | 2.52e11       | 0.247                  |
| **Ridge + категории (лучшая)** | **0.6644** | **0.6150**| **2.21e11**   | **0.252**              |

> **Бизнес-метрика**: доля прогнозов, отличающихся от реальных цен не более чем на 10%

## Что дало наибольший прирост качества

1. **Добавление категориальных признаков** — увеличило R² на ~2% (с 0.594 до 0.615)
2. **Ridge-регуляризация** — лучше справляется с мультиколлинеарностью после OneHot
3. **GridSearchCV для подбора alpha** — оптимизация гиперпараметров

## Интерпретация модели

### Наиболее важные признаки (по абсолютному значению коэффициентов):
1. **max_power** — максимальная мощность двигателя (самый важный)
2. **year** — год выпуска
3. **engine** — объём двигателя
4. **km_driven** — пробег (отрицательное влияние)
5. Категориальные: тип топлива, коробка передач, владелец

## Что не удалось и почему

- **Не занулились веса в Lasso** — все признаки информативны, малый набор данных
- **Не обработан признак `name`** — слишком много уникальных категорий (1924), требуется извлечение бренда/модели
- **Низкая бизнес-метрика (25%)** — модель точна только для 1/4 прогнозов с отклонением ±10%

**Вывод**: лучшей моделью оказалась Ridge-регрессия с категориальными признаками (R²=0.615, business metric=25.2%). Добавление категориальных фичей дало основной прирост качества.
